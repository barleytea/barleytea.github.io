{"componentChunkName":"component---src-templates-detail-tsx","path":"/java8-exponential-backoff-retry/","result":{"data":{"markdownRemark":{"id":"c4b6cb37-cbbb-51e4-81c7-55aec4612bea","html":"<div class=\"toc\">\n<ul>\n<li><a href=\"#tl-dr\">TL; DR</a></li>\n</ul>\n</div>\n<h2 id=\"tl-dr\" style=\"position:relative;\"><a href=\"#tl-dr\" aria-label=\"tl dr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL; DR</h2>\n<p>とりあえず成果物</p>\n<div class=\"gatsby-code-title\">RetryCommand.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">tech<span class=\"token punctuation\">.</span>barlog<span class=\"token punctuation\">.</span>examples</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>function<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Supplier</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Getter</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RequiredArgsConstructor</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span>extern<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Slf4j</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestClientResponseException</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> maxRetries<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Getter</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> retryCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * 関数を受け取って実行し、例外が発生したら最大 {@code maxRetries} 回リトライ処理を行う\n     * @param function 実行する関数\n     * @return 渡された関数の戻り値\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">retry</span><span class=\"token punctuation\">(</span>function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">T</span> <span class=\"token function\">retry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>retryCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> retryCount <span class=\"token operator\">&lt;=</span> maxRetries<span class=\"token punctuation\">;</span> retryCount<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">long</span> timeSleep <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> retryCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>timeSleep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Retried %d times, error : %s\"</span><span class=\"token punctuation\">,</span> retryCount<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// すべてのリトライに失敗したとき、実行時例外を送出する</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All attempts failed. %d times.\"</span><span class=\"token punctuation\">,</span> maxRetries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">RetryCommandTest.java</div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">tech<span class=\"token punctuation\">.</span>barlog<span class=\"token punctuation\">.</span>examples</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Assert</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>hamcrest<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CoreMatchers</span><span class=\"token punctuation\">.</span><span class=\"token static\">is</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryCommandTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">MAX_RETRY_COUNT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">RESULT_SUCCESS</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRunWithoutRetry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_RETRY_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRunWithRetryOnce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> retryCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_RETRY_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"First run \"</span>\n                    <span class=\"token operator\">+</span> <span class=\"token string\">\"should fail for this case. retryCount: %d\"</span><span class=\"token punctuation\">,</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRunWithRetryTwice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> retryCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_RETRY_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"First retry attempt \"</span>\n                    <span class=\"token operator\">+</span> <span class=\"token string\">\"should fail for this case. retryCount: %d\"</span><span class=\"token punctuation\">,</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRunWithRetryThreeTimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> retryCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_RETRY_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"First and second retry attempts \"</span>\n                    <span class=\"token operator\">+</span> <span class=\"token string\">\"should fail for this case. retryCount: %d\"</span><span class=\"token punctuation\">,</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RESULT_SUCCESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Test</span><span class=\"token punctuation\">(</span>expected <span class=\"token operator\">=</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRunWithAllRetryFailed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">final</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> retryCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryCommand</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_RETRY_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All retry attempts \"</span>\n                <span class=\"token operator\">+</span> <span class=\"token string\">\"should fail for this case. retryCount: %d\"</span><span class=\"token punctuation\">,</span> retryCommand<span class=\"token punctuation\">.</span><span class=\"token function\">getRetryCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"path":"/java8-exponential-backoff-retry","title":"Java8 で Exponential Backoff な retry を実装してみる","created":"2022-01-11","tags":["Java"],"eyecatcher":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmklEQVR42sWUW0gUURjHxxK0IMudOZvWWi8GYSRIzqwK7urObg3dgzaMyNWZM1MaS5cn82XogkVFYSG9hNKDYfYQJEm4O3NmkjTIQHqr994Kwl1v9HD6zpqwkJfUoA+Gc5nv/Of3ff/DcNz/ChoM5lLTXLd2IY7LYeO3oORLBffVZfai0fWrFvuiKHlsPh2WbkxFpKtrE/xdYrpebJuWpa+TQDkli9XfaytLsulXFOmQ1DUT9s+kQpUXJ2XRSsniFcqtkHC+pLQsqVSpoZMh8cR02D8yFZbas8lX5Cgbf0aqH85G/A4TmI1UzaZlUVlFD2lOMNaTz2YTIaksFfa/M4Nm7g+5qntCrh6d753JKKP9fy+sKJ0Zd2lgzxFauzdA5fIKWl+eYHvFxquNPm3EsyzZfDLCTr+gO6NeNXnc1/qxNNDUJ1472d7a0nAvzl34VFnUPIh4zXmGDDuWOboIaUbQd3lkg4CdDoSJy+vkebGa6PZgt6sQv+0oMIbbkG7VsDzU8iGOWsd6lxLksl8KOnkKor0CtjVBI9iLySUvTt5CMVLkOTNYAPvDCNsHMmdMuoTrdK50QXUDvG4PwMG7gubcAdonCLs3N51N8LxG6jyYVGXnLxzgHI/dYwImp3k1WY80+zOQWrAegmcciPsYHUstbHpTsjlGtiwiNIfsaU6WeePjVGh53+NpHNguGGPFWw3bz2gKjcSO0vhgHiuZ162j0OeXvDq0LdvQBUMw3ENQ4gugeY10pw/cfgykD2DdCSKP4Abc57F9HfICsD4FH/MtK8qCN8huKLcBaVazoFtqxhzdURG2GsGg82DUbWjD4eXFTJI75zQksSt0ztmFdLcGGe5+ID+INKIIqlOxM0by//U/HKj+vC6/AOUeDouS8QQgAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/d895b7834dda35ec3cfb1a0b877bb9c8/2c84b/eyecatcher.png","srcSet":"/static/d895b7834dda35ec3cfb1a0b877bb9c8/8ef0e/eyecatcher.png 36w,\n/static/d895b7834dda35ec3cfb1a0b877bb9c8/b0e74/eyecatcher.png 72w,\n/static/d895b7834dda35ec3cfb1a0b877bb9c8/2c84b/eyecatcher.png 144w","sizes":"(min-width: 144px) 144px, 100vw"},"sources":[{"srcSet":"/static/d895b7834dda35ec3cfb1a0b877bb9c8/9a807/eyecatcher.webp 36w,\n/static/d895b7834dda35ec3cfb1a0b877bb9c8/de323/eyecatcher.webp 72w,\n/static/d895b7834dda35ec3cfb1a0b877bb9c8/1b3aa/eyecatcher.webp 144w","type":"image/webp","sizes":"(min-width: 144px) 144px, 100vw"}]},"width":300,"height":300}}}}},"tags":{"nodes":[{"frontmatter":{"path":"/rest-template-x-www-form-urlencoded","title":"Spring Boot の RestTemplate で application/x-www-form-urlencoded な request を送信する","eyecatcher":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png","srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/045ab/eyecatcher.png 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/ca354/eyecatcher.png 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png 97w","sizes":"(min-width: 97px) 97px, 100vw"},"sources":[{"srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/b5862/eyecatcher.webp 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/c5379/eyecatcher.webp 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/7be46/eyecatcher.webp 97w","type":"image/webp","sizes":"(min-width: 97px) 97px, 100vw"}]},"width":120,"height":90.30927835051547}}}}},{"frontmatter":{"path":"/rest-template-500","title":"Spring Boot の RestTemplate で 500 系エラーが発生した場合でも reponse header / body の中身を取得する","eyecatcher":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png","srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/045ab/eyecatcher.png 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/ca354/eyecatcher.png 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png 97w","sizes":"(min-width: 97px) 97px, 100vw"},"sources":[{"srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/b5862/eyecatcher.webp 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/c5379/eyecatcher.webp 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/7be46/eyecatcher.webp 97w","type":"image/webp","sizes":"(min-width: 97px) 97px, 100vw"}]},"width":120,"height":90.30927835051547}}}}}]}},"pageContext":{"id":"c4b6cb37-cbbb-51e4-81c7-55aec4612bea","next":{"frontmatter":{"created":"2022-01-11","title":"Spring Boot の RestTemplate で application/x-www-form-urlencoded な request を送信する","path":"/rest-template-x-www-form-urlencoded","tags":["Java","Spring"],"eyecatcher":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png","srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/045ab/eyecatcher.png 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/ca354/eyecatcher.png 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/3e6e8/eyecatcher.png 97w","sizes":"(min-width: 97px) 97px, 100vw"},"sources":[{"srcSet":"/static/b5a618f143c96f4721cc0142d76f83ea/b5862/eyecatcher.webp 24w,\n/static/b5a618f143c96f4721cc0142d76f83ea/c5379/eyecatcher.webp 49w,\n/static/b5a618f143c96f4721cc0142d76f83ea/7be46/eyecatcher.webp 97w","type":"image/webp","sizes":"(min-width: 97px) 97px, 100vw"}]},"width":120,"height":90.30927835051547}}}}},"prev":{"frontmatter":{"created":"2022-01-12","title":"プロジェクトごとに使用する Rust のバージョンを指定する","path":"/20220112-rust-version-each-project","tags":["Rust"],"eyecatcher":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/3e991d04eaf43675632b86ed212a143e/eaefa/eyecatcher.png","srcSet":"/static/3e991d04eaf43675632b86ed212a143e/51b57/eyecatcher.png 30w,\n/static/3e991d04eaf43675632b86ed212a143e/e63fa/eyecatcher.png 60w,\n/static/3e991d04eaf43675632b86ed212a143e/eaefa/eyecatcher.png 120w","sizes":"(min-width: 120px) 120px, 100vw"},"sources":[{"srcSet":"/static/3e991d04eaf43675632b86ed212a143e/f1e6c/eyecatcher.webp 30w,\n/static/3e991d04eaf43675632b86ed212a143e/eea8f/eyecatcher.webp 60w,\n/static/3e991d04eaf43675632b86ed212a143e/43b57/eyecatcher.webp 120w","type":"image/webp","sizes":"(min-width: 120px) 120px, 100vw"}]},"width":120,"height":90}}}}},"tags":["Java"]}},"staticQueryHashes":["1725357224"],"slicesMap":{}}